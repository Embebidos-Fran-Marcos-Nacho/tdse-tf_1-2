GUIA RAPIDA DE USO DEL FIRMWARE
===============================

1) Antes de correr
------------------
- Placa objetivo: NUCLEO-F103RB.
- Bluetooth: HC-06 en USART1 (PA9/PA10).
- Consola de logs por USB ST-Link (USART2 VCP).
- Revisar pinout en:
  - Software STM32/pinout.txt
  - Memoria técnica/cosas para memoria técnica - hardware/resumen pines y estados logicos.txt


2) Modos principales
--------------------
- Modo normal:
  - APP_TEST_MODE = 0
  - Sin trazas de prueba, comportamiento de producto.

- Modo prueba:
  - APP_TEST_MODE = 1
  - Activa logs y utilidades de test (ZC simulado, onda 100 Hz).

Las macros se configuran en:
  Software STM32/main/app/inc/app.h


3) Funcionamiento de los DIP
----------------------------
- DIP1 (PC0): habilita Bluetooth.
- DIP2 (PC1): habilita buzzer.
- DIP3 (PB0): habilita LED.
- DIP4 (PA4): selector demo/falla:
  - 0: normal
  - 1: fuerza estado FAULT (útil para demo)


4) Configuracion del buzzer (donde tocar codigo)
------------------------------------------------
- Habilitacion por DIP:
  - DIP2 controla `buzzer_enabled`.
  - Archivo: `Software STM32/main/app/src/task_system.c` (funcion `apply_dip_roles`).

- Condicion de encendido:
  - El buzzer suena solo en `FAULT` cuando `alarm_on=1` y `buzzer_enabled=1`.
  - Archivo: `Software STM32/main/app/src/task_pwm.c` (funcion `task_pwm_update`).

- Frecuencia y duty del tono:
  - `BUZZER_FREQ_HZ` (actual: 2000 Hz)
  - `BUZZER_DUTY_PERCENT` (actual: 30%)
  - Archivo: `Software STM32/main/app/src/task_pwm.c`.

- Pin fisico/salida PWM:
  - PA8 como `TIM1_CH1` (label `BUZZER`).
  - Referencias: `Software STM32/main/Core/Inc/main.h`,
    `Software STM32/main/Core/Src/stm32f1xx_hal_msp.c`.


5) Flujo de demo recomendado
----------------------------
1. Flashear firmware.
2. Abrir consola serial del ST-Link VCP (USART2, 115200 8N1).
3. Poner APP_TEST_MODE = 1 para ver trazas.
4. Probar:
   - Botón de luz (PC12): debe togglear estado de luz.
   - Dimmer fijo (demo): el porcentaje se fija en `APP_DIMMER_FIXED_PERCENT`.
   - Bluetooth (DIP1=1): deben aparecer TX binarios en logs (`adc_percent` y `light_enabled`).
   - Falla (DIP4=1): LED/Buzzer de alarma según DIP3/DIP2.


6) Prueba sin hardware de cruce por cero
----------------------------------------
- Opción A (software): APP_TEST_SIMULATE_ZC = 1.
- Opción B (señal física): APP_TEST_WAVE_100HZ_PIN = 1 para generar 100 Hz en PC8
  y puentear PC8 -> PC2 (ZCD_INT).


7) Bluetooth AT (vivo del modulo)
---------------------------------
- En init puede enviar "AT" (sin CR/LF) y esperar "OK".
- Configurable en app.h:
  - APP_BT_AT_PROBE_ON_INIT
  - APP_BT_AT_PROBE_STRICT


8) Formato de telemetria Bluetooth (salida STM32 -> app)
--------------------------------------------------------
- Trama fija de 2 bytes por USART1 (HC-06), sin JSON:
  - Byte 0: `adc_percent` (0..100).
  - Byte 1: `light_enabled` (0 apagada, 1 encendida).
- El orden de bytes es fijo y debe respetarse en MIT App Inventor.


9) Para entrega final
---------------------
- Dejar APP_TEST_MODE = 0.
- Mantener DIP4 en 0 para operación normal.
